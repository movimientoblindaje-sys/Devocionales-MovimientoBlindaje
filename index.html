<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devocionales Movimiento Blindaje</title>
    <!-- Importación de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fuente y estilo global */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffc61a; /* AMARILLO: Fondo principal del Body (color deseado) */
            color: #f3f4f6; /* Blanco/Gris claro para el texto fuera de la tarjeta */
        }
        .container-card {
            background: #1f2937; /* NEGRO/Gris Oscuro: Tarjeta principal (el nuevo color) */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4); /* Sombra más fuerte */
        }
        /* Estilos personalizados para el slider de tiempo */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #4b5563; /* Riel del slider oscuro */
            border-radius: 3px;
            outline: none;
            transition: opacity .2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #10b981; /* Esmeralda (Accent) */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(16, 185, 129, 0.7);
        }
        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #10b981; /* Esmeralda (Accent) */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(16, 185, 129, 0.7);
        }

        /* Título del audio reproduciéndose - Marquee */
        .playing-title {
            animation: marquee 15s linear infinite;
            white-space: nowrap;
            overflow: hidden;
            width: 150%;
            display: inline-block;
            margin-left: -25%;
        }
        /* Definición de la animación Marquee */
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body class="flex items-start justify-center min-h-screen p-4 sm:p-6 md:p-8">

    <!-- Tarjeta Principal del Reproductor -->
    <div id="player-container" class="container-card w-full max-w-sm lg:max-w-xl p-6 rounded-xl space-y-6 mt-10 text-white">
        
        <!-- 1. Logo de Movimiento Blindaje -->
        <div class="flex justify-center mb-6">
             <!-- Placeholder del logo con colores de Blindaje (Amarillo/Negro) -->
             <img src="https://placehold.co/150x50/ffc61a/1f2937?text=BLINDAJE+LOGO" 
                  alt="Logo Movimiento Blindaje" 
                  class="h-12 w-auto rounded-md shadow-md"
                  onerror="this.onerror=null; this.src='https://placehold.co/150x50/ffc61a/1f2937?text=BLINDAJE+LOGO'">
        </div>
        
        <h1 class="text-3xl font-extrabold text-center text-yellow-400">Blindaje Devocional</h1>
        
        <!-- Sección de Carátula y Metadatos -->
        <div class="flex flex-col items-center space-y-4">
            <img id="cover-image" class="w-48 h-48 rounded-lg shadow-xl object-cover border-2 border-yellow-400" 
                 src="https://placehold.co/192x192/10b981/ffffff?text=S-1" 
                 alt="Carátula del Devocional" 
                 onerror="this.onerror=null; this.src='https://placehold.co/192x192/10b981/ffffff?text=Blindaje'">
            
            <div class="text-center w-full overflow-hidden px-4">
                <!-- Contenedor del título con overflow oculto para el efecto marquee -->
                <div class="overflow-hidden h-6">
                    <p id="current-title" class="text-xl font-semibold playing-title text-white">Cargando devocional...</p>
                </div>
                <!-- Letras claras para contraste -->
                <p id="current-speaker" class="text-sm text-gray-400 font-medium">Orador: Desconocido</p>
            </div>
        </div>

        <!-- Controles de Tiempo -->
        <div class="space-y-2">
            <input type="range" id="seek-slider" min="0" value="0" class="w-full">
            <!-- Letras claras para contraste -->
            <div class="flex justify-between text-xs font-mono text-gray-300">
                <span id="current-time">0:00</span>
                <span id="duration-time">0:00</span>
            </div>
        </div>

        <!-- Botones de Control (Play, Rewind, Fast Forward) -->
        <div class="flex justify-center items-center space-x-6">
            
            <!-- Botón Retroceder 5s (Nuevo icono: rebobinado doble flecha más simple) -->
            <!-- Icono en color blanco para más claridad -->
            <button id="rewind-btn" class="text-white hover:text-green-400 transition duration-150 p-2 rounded-full hover:bg-gray-800" title="Retroceder 5s">
                <!-- SVG de Rebobinado -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 19c-3.31 0-6-2.69-6-6s2.69-6 6-6h9l-3.5 3.5m3.5-3.5-3.5-3.5"/>
                    <text x="12" y="19" font-family="Inter, sans-serif" font-size="6" font-weight="bold" fill="currentColor" text-anchor="middle" dominant-baseline="central">-5</text>
                </svg>
            </button>

            <!-- Botón principal mantiene el color de marca (verde) -->
            <button id="play-pause-btn" class="bg-green-600 text-white p-4 rounded-full shadow-lg hover:bg-green-700 transition duration-150 transform hover:scale-105" title="Reproducir/Pausar">
                <!-- Icono de Play (Inicial) -->
                <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M7 6v12l10-6z"/></svg>
                <!-- Icono de Pause (Oculto) -->
                <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M6 5h3v14H6zM15 5h3v14h-3z"/></svg>
            </button>
            
            <!-- Botón Avanzar 5s (Nuevo icono: avance rápido doble flecha más simple) -->
            <!-- Icono en color blanco para más claridad -->
            <button id="forward-btn" class="text-white hover:text-green-400 transition duration-150 p-2 rounded-full hover:bg-gray-800" title="Avanzar 5s">
                <!-- SVG de Avance Rápido -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M13 19c3.31 0 6-2.69 6-6s-2.69-6-6-6H5l3.5 3.5m-3.5-3.5 3.5-3.5"/>
                    <text x="12" y="19" font-family="Inter, sans-serif" font-size="6" font-weight="bold" fill="currentColor" text-anchor="middle" dominant-baseline="central">+5</text>
                </svg>
            </button>
        </div>

        <!-- Botón de Compartir y Mensaje -->
        <div class="text-center">
            <!-- Botón de compartir en gris más claro, texto en oscuro (para el contraste con el fondo del botón) -->
            <button id="share-btn" class="bg-gray-700 text-gray-100 text-sm font-medium py-2 px-4 rounded-full hover:bg-gray-600 transition duration-150 flex items-center justify-center mx-auto space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><path d="m8.59 13.51 6.83 3.98"/><path d="m15.42 6.51-6.83 3.98"/></svg>
                <span>Compartir Devocional Actual</span>
            </button>
            <!-- Mensaje de éxito en amarillo -->
            <p id="share-message" class="text-yellow-400 text-xs mt-2 hidden">¡Enlace copiado al portapapeles!</p>
        </div>

        <!-- Lista de Reproducción Desplegable -->
        <div class="mt-8 pt-4 border-t border-gray-700">
            <!-- Texto y flecha en color claro, hover en accent (verde) -->
            <button id="toggle-playlist" class="w-full text-left flex justify-between items-center text-lg font-semibold text-white hover:text-green-400 p-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition duration-150">
                <span>Lista de Devocionales (13 audios)</span>
                <svg id="arrow-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform rotate-0 transition duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
            </button>

            <ul id="playlist-ul" class="mt-4 space-y-2 max-h-64 overflow-y-auto hidden">
                <!-- Los elementos de la lista se inyectarán aquí por JavaScript -->
            </ul>
        </div>
    </div>

    <!-- Audio Player (Oculto) -->
    <audio id="audio-player" src=""></audio>

    <script type="module">
        // JSON de la lista de devocionales
        const devocionales = [
            { id: 1, title: "1. La Parábola del Sembrador", speaker: "Pastor Luis Morales", duration: "25:47", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/1_La_Parabola_Del_Sembrador.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-1" },
            { id: 2, title: "2. El Poder de la Oración", speaker: "Pastora Ana Morales", duration: "18:15", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/2_El_Poder_De_La_Oracion.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-2" },
            { id: 3, title: "3. La Armadura de Dios", speaker: "Pastor Daniel Sosa", duration: "22:30", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/3_La_Armadura_De_Dios.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-3" },
            { id: 4, title: "4. Fe en Tiempos de Crisis", speaker: "Pastora Elena Torres", duration: "19:55", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/4_Fe_En_Tiempos_De_Crisis.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-4" },
            { id: 5, title: "5. El Fruto del Espíritu", speaker: "Pastor Luis Morales", duration: "24:10", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/5_El_Fruto_Del_Espiritu.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-5" },
            { id: 6, title: "6. La Restauración de Israel", speaker: "Pastora Ana Morales", duration: "17:40", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/6_La_Restauracion_De_Israel.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-6" },
            { id: 7, title: "7. La Obediencia trae Bendición", speaker: "Pastor Daniel Sosa", duration: "20:05", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/7_La_Obediencia_Trae_Bendicion.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-7" },
            { id: 8, title: "8. El Gran Mandamiento", speaker: "Pastora Elena Torres", duration: "21:50", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/8_El_Gran_Mandamiento.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-8" },
            { id: 9, title: "9. La Fidelidad de Dios", speaker: "Pastor Luis Morales", duration: "23:00", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/9_La_Fidelidad_De_Dios.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-9" },
            { id: 10, title: "10. Viviendo en Santidad", speaker: "Pastora Ana Morales", duration: "16:45", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/10_Viviendo_En_Santidad.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-10" },
            { id: 11, title: "11. La Esperanza de la Gloria", speaker: "Pastor Daniel Sosa", duration: "27:12", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/11_La_Esperanza_De_La_Gloria.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-11" },
            { id: 12, title: "12. Amando a Nuestro Prójimo", speaker: "Pastora Elena Torres", duration: "19:20", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/12_Amando_A_Nuestro_Proximo.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-12" },
            { id: 13, title: "13. El Perdón Genuino", speaker: "Pastor Luis Morales", duration: "20:00", url: "https://movimientoblindaje-sys.github.io/Devocionales-MovimientoBlindaje/assets/audios/13_El_Perdon_Genuino.mp3", cover: "https://placehold.co/192x192/10b981/ffffff?text=S-13" }
        ];

        // Elementos del DOM
        const audioPlayer = document.getElementById('audio-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const seekSlider = document.getElementById('seek-slider');
        const currentTimeEl = document.getElementById('current-time');
        const durationTimeEl = document.getElementById('duration-time');
        const rewindBtn = document.getElementById('rewind-btn');
        const forwardBtn = document.getElementById('forward-btn');
        const currentTitleEl = document.getElementById('current-title');
        const currentSpeakerEl = document.getElementById('current-speaker');
        const coverImage = document.getElementById('cover-image');
        const playlistUl = document.getElementById('playlist-ul');
        const togglePlaylistBtn = document.getElementById('toggle-playlist');
        const arrowIcon = document.getElementById('arrow-icon');
        const shareBtn = document.getElementById('share-btn');
        const shareMessage = document.getElementById('share-message');

        let isPlaying = false;
        let currentDevocionalIndex = 0;
        
        // Constante para el salto de tiempo
        const JUMP_TIME_SECONDS = 5;

        /**
         * Inicializa la lista de reproducción en el DOM y carga el devocional inicial.
         */
        function initializePlaylist() {
            playlistUl.innerHTML = '';
            devocionales.forEach((devocional, index) => {
                const li = document.createElement('li');
                // Estilo para lista en fondo oscuro: texto claro y hover gris oscuro
                li.className = 'flex items-center justify-between p-3 rounded-lg cursor-pointer transition duration-150 ease-in-out bg-gray-800 hover:bg-gray-700 text-white';
                li.id = `devocional-${devocional.id}`;
                li.setAttribute('data-index', index);
                
                // Contenido del elemento de la lista
                li.innerHTML = `
                    <div class="flex flex-col truncate">
                        <span class="font-medium text-sm truncate">${devocional.title}</span>
                        <span class="text-xs text-gray-400">${devocional.speaker}</span>
                    </div>
                    <span class="text-xs font-mono text-gray-400">${devocional.duration}</span>
                `;

                // Evento de clic para cambiar de devocional
                li.addEventListener('click', () => {
                    loadDevocional(index);
                    playAudio();
                });

                playlistUl.appendChild(li);
            });

            // Revisa si hay un ID en la URL para iniciar la reproducción
            const params = new URLSearchParams(window.location.search);
            const devocionalId = parseInt(params.get('id'));

            if (devocionalId) {
                const index = devocionales.findIndex(d => d.id === devocionalId);
                if (index !== -1) {
                    currentDevocionalIndex = index;
                    // Abrir la playlist si se carga un audio específico
                    playlistUl.classList.remove('hidden');
                    arrowIcon.classList.add('rotate-180');
                }
            }

            // Carga el devocional inicial o el del parámetro de URL
            loadDevocional(currentDevocionalIndex);
        }

        /**
         * Carga la información y el archivo de audio para el devocional dado.
         * @param {number} index - El índice del devocional en el array.
         */
        function loadDevocional(index) {
            currentDevocionalIndex = index;
            const devocional = devocionales[index];
            
            // Actualiza el reproductor
            audioPlayer.src = devocional.url;
            currentTitleEl.textContent = devocional.title;
            currentSpeakerEl.textContent = `Orador: ${devocional.speaker}`;
            coverImage.src = devocional.cover;

            // Actualiza la clase activa en la lista de reproducción
            document.querySelectorAll('#playlist-ul li').forEach(li => {
                // Remueve todas las clases de activo y restaura las de inactivo (fondo oscuro)
                li.classList.remove('bg-green-600', 'text-yellow-400', 'font-bold');
                li.classList.add('bg-gray-800', 'text-white');
                
                const speakerEl = li.querySelector('.text-yellow-400, .text-gray-400');
                if (speakerEl) {
                    speakerEl.classList.remove('text-yellow-400');
                    speakerEl.classList.add('text-gray-400');
                }
                const durationEl = li.querySelector('.font-mono');
                 if (durationEl) {
                    durationEl.classList.remove('text-yellow-400');
                    durationEl.classList.add('text-gray-400');
                }
            });
            
            const activeLi = document.getElementById(`devocional-${devocional.id}`);
            if (activeLi) {
                // Añade clases de activo (fondo verde, texto amarillo para máximo contraste)
                activeLi.classList.add('bg-green-600', 'text-yellow-400', 'font-bold');
                activeLi.classList.remove('bg-gray-800', 'text-white');
                
                // Cambia el color del orador y duración a amarillo
                const speakerEl = activeLi.querySelector('.text-gray-400');
                if (speakerEl) {
                    speakerEl.classList.add('text-yellow-400');
                    speakerEl.classList.remove('text-gray-400');
                }
                const durationEl = activeLi.querySelector('.font-mono');
                 if (durationEl) {
                    durationEl.classList.add('text-yellow-400');
                    durationEl.classList.remove('text-gray-400');
                }
                
                // Asegura que el elemento activo sea visible
                activeLi.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        /**
         * Alterna entre los estados de Reproducir y Pausar.
         */
        function togglePlayPause() {
            if (isPlaying) {
                pauseAudio();
            } else {
                playAudio();
            }
        }

        /**
         * Inicia la reproducción del audio.
         */
        function playAudio() {
            audioPlayer.play().catch(e => console.error("Error al intentar reproducir:", e));
            isPlaying = true;
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
        }

        /**
         * Pausa la reproducción del audio.
         */
        function pauseAudio() {
            audioPlayer.pause();
            isPlaying = false;
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        }

        /**
         * Formatea el tiempo en minutos:segundos (MM:SS).
         * @param {number} seconds - Tiempo en segundos.
         * @returns {string} Tiempo formateado.
         */
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            const paddedSeconds = remainingSeconds < 10 ? '0' + remainingSeconds : remainingSeconds;
            return `${minutes}:${paddedSeconds}`;
        }

        // --- Event Listeners del Audio Player ---

        // 1. Botón Play/Pause
        playPauseBtn.addEventListener('click', togglePlayPause);

        // 2. Cuando el audio está cargado y listo (para obtener la duración)
        audioPlayer.addEventListener('loadedmetadata', () => {
            durationTimeEl.textContent = formatTime(audioPlayer.duration);
            seekSlider.max = audioPlayer.duration;
        });

        // 3. Actualización del tiempo (mientras se reproduce)
        audioPlayer.addEventListener('timeupdate', () => {
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            seekSlider.value = audioPlayer.currentTime;
        });

        // 4. Slider de búsqueda (permite arrastrar y soltar)
        seekSlider.addEventListener('input', () => {
            audioPlayer.currentTime = seekSlider.value;
        });
        
        // 5. Reproducción terminada (avanza al siguiente)
        audioPlayer.addEventListener('ended', () => {
            const nextIndex = (currentDevocionalIndex + 1) % devocionales.length;
            loadDevocional(nextIndex);
            playAudio(); // Reproducir automáticamente el siguiente
        });

        // 6. Botones de Avance/Retroceso
        rewindBtn.addEventListener('click', () => {
            // Retrocede JUMP_TIME_SECONDS (5 segundos)
            audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - JUMP_TIME_SECONDS);
        });

        forwardBtn.addEventListener('click', () => {
            // Avanza JUMP_TIME_SECONDS (5 segundos)
            audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + JUMP_TIME_SECONDS);
        });

        // 7. Toggle de Lista de Reproducción
        togglePlaylistBtn.addEventListener('click', () => {
            playlistUl.classList.toggle('hidden');
            arrowIcon.classList.toggle('rotate-180');
        });

        // 8. Botón de Compartir
        shareBtn.addEventListener('click', () => {
            const currentId = devocionales[currentDevocionalIndex].id;
            // Construye el enlace base
            const baseUrl = window.location.origin + window.location.pathname.replace('index.html', '').replace('audio_player.html', '');
            const shareUrl = `${baseUrl}?id=${currentId}`;

            // Copia al portapapeles
            const tempInput = document.createElement('input');
            tempInput.value = shareUrl;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            // Mostrar mensaje de éxito
            shareMessage.classList.remove('hidden');
            setTimeout(() => {
                shareMessage.classList.add('hidden');
            }, 3000);
        });

        // Iniciar la aplicación
        initializePlaylist();
    </script>
</body>
</html>
