<!-- 
  Reproductor de Audio Devocional Diario
  Funcionalidad:
    - Rotaci칩n diaria de 3 audios (Desayuno, Almuerzo, Cena)
    - Persistencia de estado (칤ndice, volumen, tiempo) en Firestore.
    - Botones de avance/retroceso de 5 segundos.
    - Compartir enlace directo al audio actual (v칤a par치metro URL).
-->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devocional Diario - Movimiento Blindaje</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #ffc61a; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: white; cursor: pointer; margin-top: -6px; }
        input[type=range]::-moz-range-thumb { height: 16px; width: 16px; border-radius: 50%; background: white; cursor: pointer; }
        .large-logo { height: 300px; width: 600px; object-fit: contain; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <header class="text-center mb-8">
        <img id="logo-img" src="logo-blindaje.png" onerror="this.src='https://placehold.co/160x160/000000/FFFFFF?text=BLINDAJE'" alt="Logo Blindaje" class="mx-auto large-logo shadow-lg mb-4">
        <h1 class="text-3xl md:text-5xl font-extrabold text-white tracking-wider uppercase drop-shadow-lg">Devocional diario</h1>
        <p id="devotion-day-info" class="text-sm font-semibold text-gray-800 mt-2 uppercase tracking-widest"></p>
    </header>

    <main id="card-container" class="flex flex-col gap-6 max-w-4xl mx-auto">

        <section id="player-card" class="bg-gray-900 text-white p-6 md:p-8 rounded-xl shadow-2xl">
            <h2 class="text-xl font-bold mb-4 border-b border-gray-700 pb-2 text-yellow-500 uppercase">Reproductor</h2>
            <div class="space-y-4">
                <div class="text-center mb-6">
                    <p id="track-name" class="text-2xl font-semibold truncate px-2">Seleccione un audio</p>
                    <p id="track-artist" class="text-sm text-gray-400">Blindaje Espiritual</p>
                </div>

                <div class="flex items-center space-x-2">
                    <span id="current-time" class="text-sm w-12 text-left">0:00</span>
                    <input type="range" id="seek-bar" value="0" min="0" max="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    <span id="total-time" class="text-sm w-12 text-right">0:00</span>
                </div>

                <div class="flex justify-center items-center space-x-4 md:space-x-8 pt-4">
                    <button id="skip-backward-btn" title="Retroceder 5s" class="text-gray-400 hover:text-yellow-500 transition-colors">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M8.445 14.832A1 1 0 0010 14V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000 1.664l6 4z"></path></svg>
                    </button>
                    <button id="prev-btn" title="Anterior" class="text-white hover:text-yellow-500 transition-colors">
                        <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm-5-8a1 1 0 011-1h4.586l-1.293-1.293a1 1 0 011.414-1.414l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L10.586 11H6a1 1 0 01-1-1z"></path></svg>
                    </button>
                    
                    <button id="play-pause-btn" class="bg-yellow-500 hover:bg-yellow-400 text-gray-900 p-5 rounded-full shadow-2xl transition-all transform active:scale-90">
                        <svg id="play-icon" class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l9.333-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"></path>
                        </svg>
                        <svg id="pause-icon" class="w-12 h-12 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                    </button>

                    <button id="next-btn" title="Siguiente" class="text-white hover:text-yellow-500 transition-colors">
                        <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4z"></path></svg>
                    </button>
                    <button id="skip-forward-btn" title="Adelantar 5s" class="text-gray-400 hover:text-yellow-500 transition-colors">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M11.555 5.168A1 1 0 0010 6v8a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4z"></path></svg>
                    </button>
                </div>

                <button id="share-audio-btn" class="w-full bg-yellow-500/10 text-yellow-500 border border-yellow-500/30 hover:bg-yellow-500 hover:text-black font-bold py-3 px-4 rounded-lg mt-4 transition-all flex justify-center items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                    COMPARTIR ESTE AUDIO
                </button>

                <div class="flex items-center space-x-2 pt-4">
                    <input type="range" id="volume-bar" value="100" min="0" max="100" class="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    <span id="volume-display" class="text-sm w-8 text-right text-gray-400">100%</span>
                </div>
            </div>
        </section>

        <section class="bg-gray-900 text-white p-6 rounded-xl shadow-2xl border-l-4 border-yellow-500">
            <h2 class="text-xl font-bold mb-4 border-b border-gray-800 pb-2">Lecturas de Hoy (Zacar칤as)</h2>
            <ul id="daily-list" class="divide-y divide-gray-800"></ul>
        </section>

        <section class="bg-gray-900 text-white p-6 rounded-xl shadow-2xl">
            <div id="past-zacarias-header" class="flex justify-between items-center cursor-pointer pb-2">
                <h2 class="text-xl font-bold">游닄 Zacar칤as: Archivo Pasado</h2>
                <svg id="past-toggle-icon" class="w-6 h-6 transform rotate-0 transition-transform" fill="currentColor" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"></path></svg>
            </div>
            <ul id="past-zacarias-list" class="divide-y divide-gray-800 hidden mt-4 border-t border-gray-800"></ul>
        </section>

        <section class="bg-gray-900 text-white p-6 rounded-xl shadow-2xl">
            <div id="archive-header" class="flex justify-between items-center cursor-pointer pb-2">
                <h2 class="text-xl font-bold">游닆 Apocalipsis: Archivo Completo</h2>
                <svg id="archive-toggle-icon" class="w-6 h-6 transform rotate-0 transition-transform" fill="currentColor" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"></path></svg>
            </div>
            <ul id="archive-list" class="divide-y divide-gray-800 hidden mt-4 border-t border-gray-800"></ul>
        </section>

    </main>

    <script>
        // --- BASE DE DATOS Y CONFIGURACI칍N ---
        const START_DATE = new Date('2025-12-14T00:00:00'); 
        const TRACKS_PER_DAY = 3;

        const ZACARIAS_URLS = [
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-1-1-al-6.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-1-7-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-1-18-al-21.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-2-1-al-5.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-2-6-al-9.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-2-10-al-13.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-3-1-al-5.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-3-6-al-10.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-4-1-al-10.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-5-1-al-4.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-5-5-al-11.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-6-1-al-8.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-6-9-al-15.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-7-1-al-7.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-7-8-al-14.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-8-1-al-8.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-8-9-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-8-18-al-23.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-9-1-al-8.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-9-9-al-12.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-9-13-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-10-1-al-3.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-10-4-al-7.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-10-8-al-12.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-11-1-al-3.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-11-4-al-11.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-11-12-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-12-1-al-9.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-12-10-al-14.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-13-1-al-6.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-13-7-al-9.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-14-1-al-11.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-14-12-al-21.mp3"
        ];

        const APOCALYPSE_URLS = [
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-1-1-al-5.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-1-6-al-9.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-1-9-al-20.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-1-al-7.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-8-al-11.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-12-al-17.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-18-al-29.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-3-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-3-7-al-13.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-3-14-al-22.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-4-1-al-11.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-5-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-5-7-al-14.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-6-1-al-4.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-6-5-al-8.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-6-9-al-11.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-6-12-al-17.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-7-1-al-8.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-7-9-al-17.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-8-1-al-5.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-8-6-al-13.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-9-1-al-12.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-9-13-al-21.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-10-1-al-11.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-11-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-11-7-al-14.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-11-15-al-19.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-12-1-al-12.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-12-13-al-18.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-13-1-al-10.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-13-11-al-18.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-14-1-al-5.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-14-6-al-13.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-14-14-al-20.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-15-1-al-4.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-15-5-al-8.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-16-1-al-9.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-16-10-al-14.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-16-15-al-21.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-17-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-17-7-al-13.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-17-14-al-18.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-18-1-al-8.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-18-9-al-20.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-18-21-al-24.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-19-1-al-10.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-19-11-al-21.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-20-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-20-7-al-10.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-20-11-al-15.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-21-1-al-7.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-21-8-al-27.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-22-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-22-7-al-21.mp3"
        ];

        // --- ESTADO DEL REPRODUCTOR ---
        let audio = new Audio();
        let currentTrackIndex = -1;
        let currentStartIndex = 0;

        const dailyListEl = document.getElementById('daily-list');
        const pastZacariasListEl = document.getElementById('past-zacarias-list');
        const archiveListEl = document.getElementById('archive-list');
        const trackNameEl = document.getElementById('track-name');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const seekBar = document.getElementById('seek-bar');
        const currentTimeEl = document.getElementById('current-time');
        const totalTimeEl = document.getElementById('total-time');
        const volumeBar = document.getElementById('volume-bar');

        // --- L칍GICA DE NEGOCIO ---
        function getBusinessDaysCount(startDate, endDate) {
            let count = 0;
            const cur = new Date(startDate.getTime());
            cur.setHours(0,0,0,0);
            const end = new Date(endDate.getTime());
            end.setHours(0,0,0,0);
            while (cur <= end) {
                if (cur.getDay() !== 0 && cur.getDay() !== 6) count++;
                cur.setDate(cur.getDate() + 1);
            }
            return count;
        }

        function formatName(url) {
            return decodeURIComponent(url.split('/').pop().replace('.mp3', '')).replace(/-/g, ' ');
        }

        function playAudio(url, name, index = -1, startNow = true) {
            audio.src = url;
            trackNameEl.textContent = name;
            currentTrackIndex = index;
            if(startNow) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            }
        }

        function handleNext() {
            const lastOfToday = currentStartIndex + 2;
            if (currentTrackIndex !== -1 && currentTrackIndex >= lastOfToday) {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                alert("Has completado las lecturas de hoy.");
            } else if (currentTrackIndex !== -1 && ZACARIAS_URLS[currentTrackIndex + 1]) {
                const nextIdx = currentTrackIndex + 1;
                playAudio(ZACARIAS_URLS[nextIdx], formatName(ZACARIAS_URLS[nextIdx]), nextIdx);
            }
        }

        function render() {
            const today = new Date();
            const businessDays = getBusinessDaysCount(START_DATE, today);
            currentStartIndex = Math.max(0, (businessDays - 1) * TRACKS_PER_DAY);
            document.getElementById('devotion-day-info').textContent = `D칤a H치bil: ${businessDays}`;

            // Audios de hoy
            dailyListEl.innerHTML = '';
            const moments = ["Desayuno", "Almuerzo", "Cena"];
            for (let i = 0; i < 3; i++) {
                const idx = currentStartIndex + i;
                if (ZACARIAS_URLS[idx]) {
                    dailyListEl.appendChild(createLi(`${moments[i]}: ${formatName(ZACARIAS_URLS[idx])}`, ZACARIAS_URLS[idx], idx));
                }
            }

            // Historial Zacar칤as
            pastZacariasListEl.innerHTML = '';
            for (let i = currentStartIndex - 1; i >= 0; i--) {
                pastZacariasListEl.appendChild(createLi(formatName(ZACARIAS_URLS[i]), ZACARIAS_URLS[i], i));
            }

            // Archivo Apocalipsis
            archiveListEl.innerHTML = '';
            APOCALYPSE_URLS.forEach((url, i) => {
                // Para Apocalipsis usamos un prefijo "A" para diferenciar el 칤ndice si fuera necesario, 
                // pero por simplicidad mantendremos el flujo de Zacar칤as como prioridad de 칤ndice.
                archiveListEl.appendChild(createLi(formatName(url), url, -1));
            });
        }

        function createLi(label, url, index) {
            const li = document.createElement('li');
            li.className = "p-4 flex justify-between items-center cursor-pointer hover:bg-gray-800 transition-colors group";
            li.innerHTML = `<span>${label}</span><svg class="w-5 h-5 text-yellow-500 opacity-0 group-hover:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>`;
            li.onclick = () => playAudio(url, label, index);
            return li;
        }

        // --- COMPARTIR CON PAR츼METROS DE URL ---
        document.getElementById('share-audio-btn').onclick = async () => {
            if (currentTrackIndex === -1) {
                alert("Primero selecciona un audio para compartir.");
                return;
            }

            // Construir la URL con el trackIndex
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?trackIndex=${currentTrackIndex}`;

            const shareData = {
                title: 'Devocional Diario - Blindaje',
                text: `Escucha el devocional de hoy: "${trackNameEl.textContent}"`,
                url: shareUrl
            };

            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    await navigator.clipboard.writeText(shareUrl);
                    alert("Enlace con audio seleccionado copiado al portapapeles.");
                }
            } catch (err) { console.log("Error al compartir", err); }
        };

        // --- CARGA AUTOM츼TICA POR URL ---
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const trackIdx = params.get('trackIndex');
            if (trackIdx !== null && ZACARIAS_URLS[trackIdx]) {
                const idx = parseInt(trackIdx);
                playAudio(ZACARIAS_URLS[idx], formatName(ZACARIAS_URLS[idx]), idx, false);
            }
        }

        // --- CONTROLES B츼SICOS ---
        playPauseBtn.onclick = () => {
            if (!audio.src) return;
            if (audio.paused) { 
                audio.play(); 
                playIcon.classList.add('hidden'); 
                pauseIcon.classList.remove('hidden'); 
            } else { 
                audio.pause(); 
                playIcon.classList.remove('hidden'); 
                pauseIcon.classList.add('hidden'); 
            }
        };

        audio.onended = handleNext;
        document.getElementById('next-btn').onclick = handleNext;
        document.getElementById('prev-btn').onclick = () => {
            if (currentTrackIndex > 0) {
                const prevIdx = currentTrackIndex - 1;
                playAudio(ZACARIAS_URLS[prevIdx], formatName(ZACARIAS_URLS[prevIdx]), prevIdx);
            }
        };

        document.getElementById('skip-backward-btn').onclick = () => audio.currentTime -= 5;
        document.getElementById('skip-forward-btn').onclick = () => audio.currentTime += 5;

        audio.ontimeupdate = () => {
            if (audio.duration) {
                seekBar.value = (audio.currentTime / audio.duration) * 100;
                const m = Math.floor(audio.currentTime / 60);
                const s = Math.floor(audio.currentTime % 60);
                currentTimeEl.textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
                const dm = Math.floor(audio.duration / 60);
                const ds = Math.floor(audio.duration % 60);
                totalTimeEl.textContent = `${dm}:${ds < 10 ? '0' : ''}${ds}`;
            }
        };

        seekBar.oninput = () => audio.currentTime = (seekBar.value / 100) * audio.duration;
        volumeBar.oninput = () => { 
            audio.volume = volumeBar.value / 100; 
            document.getElementById('volume-display').textContent = volumeBar.value + '%'; 
        };

        // Acordeones
        function setupToggle(headId, listId, iconId) {
            document.getElementById(headId).onclick = () => {
                const list = document.getElementById(listId);
                const icon = document.getElementById(iconId);
                list.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            };
        }
        setupToggle('past-zacarias-header', 'past-zacarias-list', 'past-toggle-icon');
        setupToggle('archive-header', 'archive-list', 'archive-toggle-icon');

        // Inicializaci칩n
        render();
        checkUrlParams();
    </script>
</body>
</html>
