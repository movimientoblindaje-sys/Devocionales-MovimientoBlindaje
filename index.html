<!-- 
  Reproductor de Audio Devocional Diario
  Funcionalidad:
    - RotaciÃ³n diaria de 3 audios (Desayuno, Almuerzo, Cena)
    - Persistencia de estado (Ã­ndice, volumen, tiempo) en Firestore.
    - Botones de avance/retroceso de 5 segundos.
    - Compartir enlace directo al audio actual (vÃ­a parÃ¡metro URL).
-->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devocional Diario - Movimiento Blindaje</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #ffc61a; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: white; cursor: pointer; margin-top: -6px; }
        .large-logo { height: 300px; width: 600px; object-fit: contain; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <header class="text-center mb-8">
        <img id="logo-img" src="logo-blindaje.png" onerror="this.src='https://placehold.co/160x160/000000/FFFFFF?text=BLINDAJE'" alt="Logo Blindaje" class="mx-auto large-logo shadow-lg mb-4">
        <h1 class="text-3xl md:text-5xl font-extrabold text-white tracking-wider uppercase drop-shadow-lg">Devocional diario</h1>
        <p id="devotion-day-info" class="text-sm font-semibold text-gray-800 mt-2 tracking-widest uppercase"></p>
    </header>

    <main class="flex flex-col gap-6 max-w-4xl mx-auto">
        
        <section class="bg-gray-900 text-white p-6 md:p-8 rounded-xl shadow-2xl">
            <h2 class="text-xl font-bold mb-4 border-b border-gray-700 pb-2 text-yellow-500 uppercase tracking-wider">Reproductor</h2>
            <div class="text-center mb-6">
                <p id="track-name" class="text-2xl font-semibold truncate px-2">Selecciona un audio para comenzar</p>
                <p class="text-sm text-gray-400 mt-1">Blindaje Espiritual</p>
            </div>
            
            <div class="flex items-center space-x-2">
                <span id="current-time" class="text-xs w-10 text-gray-400">0:00</span>
                <input type="range" id="seek-bar" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                <span id="total-time" class="text-xs w-10 text-gray-400">0:00</span>
            </div>

            <div class="flex justify-center items-center space-x-8 pt-6">
                <button id="prev-btn" class="text-gray-400 hover:text-yellow-500 transition-colors">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path d="M8.445 14.832A1 1 0 0010 14V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000 1.664l6 4zM16.445 14.832A1 1 0 0018 14V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000 1.664l6 4z"/></svg>
                </button>
                <button id="play-pause-btn" class="bg-yellow-500 text-black p-5 rounded-full shadow-xl transform hover:scale-110 transition-all active:scale-95">
                    <svg id="play-icon" class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>
                    <svg id="pause-icon" class="w-12 h-12 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 011-1h1a1 1 0 011 1v4a1 1 0 01-1 1H8a1 1 0 01-1-1V8zm5-1a1 1 0 00-1 1v4a1 1 0 001 1h1a1 1 0 001-1V8a1 1 0 00-1-1h-1z"/></svg>
                </button>
                <button id="next-btn" class="text-gray-400 hover:text-yellow-500 transition-colors">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4zM11.555 5.168A1 1 0 0010 6v8a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4z"/></svg>
                </button>
            </div>
        </section>

        <section class="bg-gray-900 text-white p-6 rounded-xl shadow-2xl border-l-4 border-yellow-500">
            <h2 class="text-xl font-bold mb-4 border-b border-gray-800 pb-2 flex items-center">
                <span class="mr-2">ðŸ“…</span> Audios de Hoy (ZacarÃ­as)
            </h2>
            <ul id="daily-list" class="divide-y divide-gray-800"></ul>
        </section>

        <section class="bg-gray-900 text-white p-6 rounded-xl shadow-2xl">
            <div id="past-zac-header" class="flex justify-between items-center cursor-pointer group">
                <h2 class="text-xl font-bold flex items-center group-hover:text-yellow-500 transition-colors">
                    <span class="mr-2">ðŸ“š</span> ZacarÃ­as: Audios Pasados
                </h2>
                <span id="past-zac-icon" class="text-yellow-500 transform transition-transform">â–¼</span>
            </div>
            <ul id="past-zac-list" class="divide-y divide-gray-800 hidden mt-4 border-t border-gray-800"></ul>
        </section>

        <section class="bg-gray-900 text-white p-6 rounded-xl shadow-2xl">
            <div id="apoc-header" class="flex justify-between items-center cursor-pointer group">
                <h2 class="text-xl font-bold flex items-center group-hover:text-yellow-500 transition-colors">
                    <span class="mr-2">ðŸ“œ</span> Apocalipsis: Archivo
                </h2>
                <span id="apoc-icon" class="text-yellow-500 transform transition-transform">â–¼</span>
            </div>
            <ul id="apoc-list" class="divide-y divide-gray-800 hidden mt-4 border-t border-gray-800"></ul>
        </section>
    </main>

    <script>
        // --- BASE DE DATOS DE ENLACES ---
        const ZACARIAS_URLS = [
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-1-1-al-6.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-1-7-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-1-18-al-21.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-2-1-al-5.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-2-6-al-9.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-2-10-al-13.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-3-1-al-5.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-3-6-al-10.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-4-1-al-10.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-5-1-al-4.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-5-5-al-11.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-6-1-al-8.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-6-9-al-15.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-7-1-al-7.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-7-8-al-14.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-8-1-al-8.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-8-9-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-8-18-al-23.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-9-1-al-8.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-9-9-al-12.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-9-13-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-10-1-al-3.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-10-4-al-7.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-10-8-al-12.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-11-1-al-3.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-11-4-al-11.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-11-12-al-17.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-12-1-al-9.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-12-10-al-14.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-13-1-al-6.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-13-7-al-9.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-14-1-al-11.mp3",
            "https://archive.org/download/devocional-de-zacarias/Devocional%20de%20Zacar%C3%ADas/Zacar%C3%ADas-14-12-al-21.mp3"
        ];

        const APOC_URLS = [
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-1-1-al-5.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-1-6-al-9.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-1-9-al-20.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-1-al-7.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-8-al-11.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-12-al-17.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-2-18-al-29.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-3-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-3-7-al-13.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-3-14-al-22.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-4-1-al-11.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-5-1-al-6.mp3",
            "https://archive.org/download/libro-de-apocalipsis/Libro-de-Apocalipsis-5-7-al-14.mp3"
        ];

        // --- CONFIGURACIÃ“N LÃ“GICA ---
        const START_DATE = new Date('2025-12-15T00:00:00');
        const TRACKS_PER_DAY = 3;

        let audio = new Audio();
        let currentIdx = -1;
        let todayStartIdx = 0;

        // --- FUNCIONES ---
        function getBusinessDaysCount(start, end) {
            let count = 0;
            let cur = new Date(start.getTime());
            cur.setHours(0,0,0,0);
            let target = new Date(end.getTime());
            target.setHours(0,0,0,0);
            while (cur <= target) {
                if (cur.getDay() !== 0 && cur.getDay() !== 6) count++;
                cur.setDate(cur.getDate() + 1);
            }
            return count;
        }

        function formatName(url) {
            return decodeURIComponent(url.split('/').pop().replace('.mp3', '')).replace(/-/g, ' ');
        }

        function playAudio(url, name, index) {
            audio.src = url;
            document.getElementById('track-name').innerText = name;
            currentIdx = index;
            audio.play();
            document.getElementById('play-icon').classList.add('hidden');
            document.getElementById('pause-icon').classList.remove('hidden');
        }

        function createLi(label, url, index) {
            const li = document.createElement('li');
            li.className = "p-4 flex justify-between items-center cursor-pointer hover:bg-gray-800 transition-colors group";
            li.innerHTML = `
                <span class="group-hover:text-yellow-500">${label}</span>
                <svg class="w-5 h-5 text-yellow-500 opacity-0 group-hover:opacity-100 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/>
                </svg>`;
            li.onclick = () => playAudio(url, label, index);
            return li;
        }

        function init() {
            const today = new Date();
            const businessDays = getBusinessDaysCount(START_DATE, today);
            todayStartIdx = (businessDays - 1) * TRACKS_PER_DAY;
            document.getElementById('devotion-day-info').innerText = `Blindaje Espiritual - DÃ­a HÃ¡bil ${businessDays}`;

            const moments = ["Desayuno", "Almuerzo", "Cena"];

            // Render Hoy
            const dList = document.getElementById('daily-list');
            dList.innerHTML = '';
            for(let i=0; i<3; i++) {
                let idx = todayStartIdx + i;
                if(ZACARIAS_URLS[idx]) {
                    dList.appendChild(createLi(`${moments[i]}: ${formatName(ZACARIAS_URLS[idx])}`, ZACARIAS_URLS[idx], idx));
                }
            }

            // Render Pasados ZacarÃ­as (Orden inverso para ver Ãºltimos primero)
            const pList = document.getElementById('past-zac-list');
            pList.innerHTML = '';
            for(let i = todayStartIdx - 1; i >= 0; i--) {
                pList.appendChild(createLi(formatName(ZACARIAS_URLS[i]), ZACARIAS_URLS[i], i));
            }

            // Render Apocalipsis
            const aList = document.getElementById('apoc-list');
            aList.innerHTML = '';
            APOC_URLS.forEach(url => aList.appendChild(createLi(formatName(url), url, -1)));
        }

        // --- CONTROLES Y EVENTOS ---
        document.getElementById('play-pause-btn').onclick = () => {
            if(!audio.src) return;
            if(audio.paused) { 
                audio.play(); 
                document.getElementById('play-icon').classList.add('hidden');
                document.getElementById('pause-icon').classList.remove('hidden');
            } else { 
                audio.pause(); 
                document.getElementById('play-icon').classList.remove('hidden');
                document.getElementById('pause-icon').classList.add('hidden');
            }
        };

        audio.onended = () => {
            // BLOQUEO: Si es la "Cena" (Ã­ndice 2 del bloque de hoy), detenerse
            if(currentIdx !== -1 && currentIdx >= todayStartIdx + 2) {
                document.getElementById('play-icon').classList.remove('hidden');
                document.getElementById('pause-icon').classList.add('hidden');
                alert("Has completado las lecturas de hoy.");
            } else if (currentIdx !== -1 && ZACARIAS_URLS[currentIdx+1]) {
                let next = currentIdx + 1;
                playAudio(ZACARIAS_URLS[next], formatName(ZACARIAS_URLS[next]), next);
            }
        };

        document.getElementById('next-btn').onclick = () => {
            if(currentIdx !== -1 && currentIdx < todayStartIdx + 2 && ZACARIAS_URLS[currentIdx+1]) {
                let next = currentIdx + 1;
                playAudio(ZACARIAS_URLS[next], formatName(ZACARIAS_URLS[next]), next);
            }
        };

        document.getElementById('prev-btn').onclick = () => {
            if(currentIdx > 0) {
                let prev = currentIdx - 1;
                playAudio(ZACARIAS_URLS[prev], formatName(ZACARIAS_URLS[prev]), prev);
            }
        };

        // Plegables con icono animado
        function setupToggle(headId, listId, iconId) {
            document.getElementById(headId).onclick = () => {
                const list = document.getElementById(listId);
                const icon = document.getElementById(iconId);
                list.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            };
        }
        setupToggle('past-zac-header', 'past-zac-list', 'past-zac-icon');
        setupToggle('apoc-header', 'apoc-list', 'apoc-icon');

        // Seekbar
        audio.ontimeupdate = () => {
            if(audio.duration) {
                document.getElementById('seek-bar').value = (audio.currentTime / audio.duration) * 100;
                document.getElementById('current-time').innerText = Math.floor(audio.currentTime / 60) + ":" + String(Math.floor(audio.currentTime % 60)).padStart(2, '0');
                document.getElementById('total-time').innerText = Math.floor(audio.duration / 60) + ":" + String(Math.floor(audio.duration % 60)).padStart(2, '0');
            }
        };
        document.getElementById('seek-bar').oninput = (e) => audio.currentTime = (e.target.value / 100) * audio.duration;

        init();
    </script>
</body>
</html>
